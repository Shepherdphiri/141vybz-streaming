<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>141VYBZ Listener</title>
</head>
<body>
  <h1>ðŸŽ§ Listening to 141VYBZ Live</h1>
  <button id="startBtn">Start Listening</button>

  <script>
    document.getElementById('startBtn').addEventListener('click', () => {
      const ws = new WebSocket(location.origin.replace(/^http/, 'ws') + '/stream');
      ws.binaryType = 'arraybuffer';

      const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      const processor = audioCtx.createScriptProcessor(4096, 1, 1);
      const bufferQueue = [];

      ws.onmessage = (event) => {
        const floatArray = new Float32Array(event.data);
        bufferQueue.push(floatArray);
      };

      processor.onaudioprocess = (e) => {
        const output = e.outputBuffer.getChannelData(0);
        if (bufferQueue.length) {
          const chunk = bufferQueue.shift();
          output.set(chunk.subarray(0, output.length));
        } else {
          output.fill(0); // silence if no data
        }
      };

      processor.connect(audioCtx.destination);
    });
  </script>
</body>
</html>
