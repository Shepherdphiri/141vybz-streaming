<!DOCTYPE html>
<html>
<head>
  <title>Live Stream</title>
</head>
<body>
  <h2>Now Listening...</h2>
  <audio id="player" controls autoplay></audio>
  <button onclick="startListening()">Connect</button>

  <script>
    function startListening() {
      const audio = document.getElementById('player');
      const socket = new WebSocket(location.origin.replace(/^http/, 'ws') + '/ws');
      socket.binaryType = 'arraybuffer';

      socket.onopen = () => socket.send('ROLE:listener');

      socket.onmessage = (e) => {
        const blob = new Blob([e.data], { type: 'audio/webm' });
        audio.src = URL.createObjectURL(blob);
        audio.play().catch(err => console.error('Playback error:', err));
      };
    }
  </script>
</body>
</html>
