<!DOCTYPE html>
<html>
<head>
  <title>Broadcast Audio</title>
</head>
<body>
  <h2>Broadcasting...</h2>
  <button onclick="startBroadcast()">Start</button>

  <script>
    async function startBroadcast() {
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      const recorder = new MediaRecorder(stream, { mimeType: 'audio/webm' });

      const socket = new WebSocket(location.origin.replace(/^http/, 'ws') + '/ws');
      socket.binaryType = 'arraybuffer';

      socket.onopen = () => {
        socket.send('ROLE:broadcaster');
        recorder.start(1000); // send audio chunks every second
      };

      recorder.ondataavailable = e => {
        if (socket.readyState === WebSocket.OPEN && e.data.size > 0) {
          e.data.arrayBuffer().then(buffer => socket.send(buffer));
        }
      };
    }
  </script>
</body>
</html>
