<!DOCTYPE html>
<html>
<head>
  <title>Broadcast Audio</title>
</head>
<body>
  <h2>Broadcast Live</h2>
  <button onclick="start()">Start Broadcasting</button>
  <script>
    async function start() {
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      const recorder = new MediaRecorder(stream, { mimeType: 'audio/webm' });

      const socket = new WebSocket(location.origin.replace(/^http/, 'ws') + '/ws');
      socket.binaryType = 'arraybuffer';

      socket.onopen = () => {
        socket.send('ROLE:broadcaster');
        recorder.start(250); // Send chunks every 250ms
      };

      recorder.ondataavailable = (e) => {
        if (socket.readyState === WebSocket.OPEN) {
          socket.send(e.data);
        }
      };
    }
  </script>
</body>
</html>
