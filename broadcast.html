<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Broadcast Live - 141VYBZ</title>
</head>
<body>
  <h1>ğŸ™ï¸ Go Live on 141VYBZ</h1>
  <button id="startBtn">Start Broadcast</button>
  <button id="stopBtn" disabled>Stop Broadcast</button>
  <script>
  const ws = new WebSocket(location.origin.replace(/^http/, 'ws') + '/broadcast');
  const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

  navigator.mediaDevices.getUserMedia({ audio: true }).then((stream) => {
    const source = audioCtx.createMediaStreamSource(stream);
    const processor = audioCtx.createScriptProcessor(4096, 1, 1);

    processor.onaudioprocess = (e) => {
      const input = e.inputBuffer.getChannelData(0);
      if (ws.readyState === WebSocket.OPEN) {
        ws.send(input.buffer); // sending raw Float32Array buffer
      }
    };

    source.connect(processor);
    processor.connect(audioCtx.destination);
  });
</script>

</body>
</html>
